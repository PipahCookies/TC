<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>3D Card Gallery Sync</title>
<style>
  *{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif}
  body{display:flex;justify-content:center;align-items:center;flex-direction:column;height:100vh;background:linear-gradient(135deg,#f8f5f0,#f2ede8);overflow:hidden}
  .gallery-container{perspective:1200px;width:350px;height:220px;position:relative;overflow:hidden;touch-action:pan-y}
  .card{position:absolute;width:100%;height:100%;border-radius:18px;box-shadow:0 8px 20px rgba(0,0,0,.15);overflow:hidden;transform-origin:center;transition:transform .6s ease,opacity .6s ease;background:rgba(255,255,255,.3);backdrop-filter:blur(6px)}
  .card img,.card video{width:100%;height:100%;object-fit:cover}
  .hidden{opacity:0;pointer-events:none}
  .card.next{transform:translateX(100%) rotateY(45deg);opacity:0}
  .card.prev{transform:translateX(-100%) rotateY(-45deg);opacity:0}
  .card.active{transform:translateX(0) rotateY(0);opacity:1;z-index:2}

  /* Thumbnails */
  .thumb-row{display:flex;justify-content:center;align-items:center;margin-top:30px;gap:10px;width:100%;overflow:hidden}
  .thumb-viewport{width:350px;overflow:hidden}
  .thumb-track{display:flex;align-items:center;will-change:transform;cursor:pointer}
  .thumb{width:60px;height:40px;border-radius:10px;overflow:hidden;opacity:.5;transition:transform .3s ease,opacity .3s ease,box-shadow .3s ease;margin:0 6px;flex-shrink:0;background:rgba(255,255,255,.25);backdrop-filter:blur(4px);transform:perspective(300px) rotateY(6deg);box-shadow:inset 0 0 6px rgba(255,255,255,.6),0 3px 10px rgba(0,0,0,.15)}
  .thumb img,.thumb video{width:100%;height:100%;object-fit:cover;display:block}
  .thumb.active{opacity:1;transform:scale(1.25) perspective(300px) rotateY(0deg);box-shadow:0 8px 18px rgba(0,0,0,.25),0 0 20px rgba(255,245,200,.6);z-index:3}
  .no-select{user-select:none;-webkit-user-select:none;-ms-user-select:none}
</style>
</head>
<body>
<div class="gallery-container" id="gallery">
  <div class="card active"><video src="images/video.mp4" autoplay muted loop></video></div>
  <div class="card next"><img src="images/ss3.jpg" alt="1"/></div>
  <div class="card hidden"><img src="images/pic30.jpg" alt="2"/></div>
  <div class="card hidden"><img src="images/ch2.jpg" alt="3"/></div>
  <div class="card hidden"><img src="images/kp2.jpg" alt="4"/></div>
  <div class="card hidden"><img src="images/rv2.jpg" alt="5"/></div>
</div>

<div class="thumb-row">
  <div class="thumb-viewport" id="thumbViewport">
    <div class="thumb-track no-select" id="thumbTrack">
      <!-- unique thumbs -->
      <div class="thumb"><video src="images/video.mp4" autoplay muted loop></video></div>
      <div class="thumb"><img src="images/ss3.jpg" alt="1"/></div>
      <div class="thumb"><img src="images/pic30.jpg" alt="2"/></div>
      <div class="thumb"><img src="images/ch2.jpg" alt="3"/></div>
      <div class="thumb"><img src="images/kp2.jpg" alt="4"/></div>
      <div class="thumb"><img src="images/rv2.jpg" alt="5"/></div>
      <!-- duplicate for infinite loop -->
      <div class="thumb"><video src="images/video.mp4" autoplay muted loop></video></div>
      <div class="thumb"><img src="images/ss3.jpg" alt="1"/></div>
      <div class="thumb"><img src="images/pic30.jpg" alt="2"/></div>
      <div class="thumb"><img src="images/ch2.jpg" alt="3"/></div>
      <div class="thumb"><img src="images/kp2.jpg" alt="4"/></div>
      <div class="thumb"><img src="images/rv2.jpg" alt="5"/></div>
    </div>
  </div>
</div>

<script>
(function(){
  const cards = document.querySelectorAll('.card');
  const gallery = document.getElementById('gallery');
  const thumbTrack = document.getElementById('thumbTrack');
  const thumbViewport = document.getElementById('thumbViewport');
  let thumbs = Array.from(thumbTrack.children);
  thumbs.forEach((thumb, idx) => {
  thumb.addEventListener('click', () => {
    const uniqueIdx = idx % uniqueCount; // map duplicates to unique index
    setActive(uniqueIdx);
  });
});
  const uniqueCount = thumbs.length/2;
  let current = 0;
  const thumbSizeWithGap = 72;

  function refreshThumbs(){ thumbs = Array.from(thumbTrack.children); }
  function showMain(index){
    cards.forEach((c,i)=>{c.classList.remove('active','next','prev','hidden'); 
      if(i===index)c.classList.add('active');
      else if(i===(index+1)%cards.length)c.classList.add('next');
      else if(i===(index-1+cards.length)%cards.length)c.classList.add('prev');
      else c.classList.add('hidden');
    });
  }

  function centerThumb(u){
    refreshThumbs();
    thumbs.forEach(t=>t.classList.remove('active'));
    // pick closest thumb from duplicates
    const viewportRect = thumbViewport.getBoundingClientRect();
    let closest=null,dist=Infinity,closestIdx=-1;
    thumbs.forEach((t,i)=>{
      if(i%uniqueCount!==u)return;
      const r=t.getBoundingClientRect();
      const c=(r.left+r.right)/2;
      const d=Math.abs(c-(viewportRect.left+viewportRect.width/2));
      if(d<dist){dist=d;closest=t;closestIdx=i;}
    });
    if(closest)closest.classList.add('active');
    if(closestIdx>=0){
      const r=thumbs[closestIdx].getBoundingClientRect();
      const vp=thumbViewport.getBoundingClientRect();
      const curX=getTranslateX(thumbTrack);
      const targetCenter=(r.left+r.right)/2;
      const vpCenter=vp.left+vp.width/2;
      const delta=vpCenter-targetCenter;
      thumbTrack.style.transition='transform 400ms cubic-bezier(.2,.9,.2,1)';
      thumbTrack.style.transform=`translateX(${curX+delta}px)`;
      setTimeout(()=>{normalizeThumb();thumbTrack.style.transition='';},450);
    }
  }

  function setActive(u){
    current=((u%uniqueCount)+uniqueCount)%uniqueCount;
    showMain(current);
    centerThumb(current);
  }

  function getTranslateX(el){
    const st=window.getComputedStyle(el);
    const tr=st.transform||st.webkitTransform;
    if(tr&&tr!=='none'){
      const m=tr.match(/matrix\((.+)\)/);
      if(m){const vals=m[1].split(',');return parseFloat(vals[4]);}
    }
    return 0;
  }

  function normalizeThumb(){
    const curX=getTranslateX(thumbTrack);
    const threshold=uniqueCount*thumbSizeWithGap;
    if(Math.abs(curX)>threshold*1.5){
      const sets=Math.round(curX/(uniqueCount*thumbSizeWithGap));
      thumbTrack.style.transition='none';
      thumbTrack.style.transform=`translateX(${curX-sets*(uniqueCount*thumbSizeWithGap)}px)`;
    }
  }

  // gallery swipe
  let gStart=0,gSwiping=false;
  gallery.addEventListener('touchstart',e=>{gStart=e.touches[0].clientX;gSwiping=true;});
  gallery.addEventListener('touchmove',e=>{
    if(!gSwiping)return;
    const diff=e.touches[0].clientX-gStart;
    if(Math.abs(diff)>50){
      current=diff>0?(current-1+uniqueCount)%uniqueCount:(current+1)%uniqueCount;
      setActive(current);
      gSwiping=false;
    }
  });
  gallery.addEventListener('touchend',()=>{gSwiping=false;});

  // thumbnails drag
  let pActive=false,startX=0,lastX=0,vel=0,lastTime=0;
  thumbViewport.addEventListener('pointerdown',e=>{
    thumbViewport.setPointerCapture(e.pointerId);
    pActive=true;startX=lastX=e.clientX;vel=0;lastTime=performance.now();thumbTrack.style.transition='none';document.body.classList.add('no-select');
  });
  window.addEventListener('pointermove',e=>{
    if(!pActive)return;
    const now=performance.now(),dt=Math.max(now-lastTime,1);
    const dx=e.clientX-lastX;
    vel=dx/dt; lastX=e.clientX; lastTime=now;
    thumbTrack.style.transform=`translateX(${getTranslateX(thumbTrack)+dx}px)`;
  });
  window.addEventListener('pointerup',()=>{
    if(!pActive)return;pActive=false;document.body.classList.remove('no-select');
    const momentum=vel*250; 
    const cur=getTranslateX(thumbTrack);
    let targetX=cur+momentum;

    const vp=thumbViewport.getBoundingClientRect();
    let best=-1,bd=Infinity;
    thumbs.forEach((t,i)=>{
      const r=t.getBoundingClientRect();
      const center=(r.left+r.right)/2;
      const sim=center+(targetX-cur);
      const d=Math.abs(sim-(vp.left+vp.width/2));
      if(d<bd){bd=d;best=i;}
    });
    if(best<0)best=0;
    const rBest=thumbs[best].getBoundingClientRect();
    const delta=(vp.left+vp.width/2)-(rBest.left+rBest.right)/2;
    targetX=cur+delta;
    thumbTrack.style.transition='transform 600ms cubic-bezier(.2,.9,.2,1)';
    thumbTrack.style.transform=`translateX(${targetX}px)`;

    setTimeout(()=>{
      normalizeThumb();refreshThumbs();
      const closestI=best;
      const uniqueIdx=closestI%uniqueCount;
      setActive(uniqueIdx);
      setTimeout(()=>thumbTrack.style.transition='',50);
    },650);
  });

  // initial
  setActive(0);
})();
</script>
</body>
</html>